<!doctype html>
<html lang="ru">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
    <title>AR Box — marker (HIRO)</title>
    <script src="https://cdn.jsdelivr.net/npm/aframe@1.5.0/dist/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/ar.js@3.4.4/aframe/build/aframe-ar.min.js"></script>
    <style>
      html,body { margin:0; padding:0; height:100%; background:#000; }
      .ui { position: fixed; inset: 0 auto auto 0; right: 0; padding: 10px 12px; color:#fff;
        font: 14px/1.35 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; z-index: 10; pointer-events: none; }
      .row { display:flex; gap:10px; align-items:center; justify-content:center; pointer-events:auto; flex-wrap: wrap; }
      .badge { display:inline-block; padding:2px 6px; border:1px solid rgba(255,255,255,.35); border-radius:999px; font-size:12px; }
      .btn { appearance:none; border:1px solid rgba(255,255,255,.35); background:#111; color:#fff; border-radius:10px; padding:8px 12px; cursor:pointer; }
      .btn:active { transform: translateY(1px); }
      .footer { position: fixed; left:0; right:0; bottom:0; padding:10px 12px; color:#bbb; text-align:center; font-size:12px;
        background: linear-gradient(0deg, rgba(0,0,0,.65), rgba(0,0,0,0)); z-index: 10; }
      a { color:#8fb9ff }
    </style>
  </head>
  <body>
    <div class="ui">
      <div class="row" style="margin-bottom:8px">
        <span>Наведи камеру на <span class="badge">HIRO</span>-маркер на чёрной коробке.</span>
      </div>
      <div class="row">
        <button class="btn" onclick="openMarker()">Открыть маркер HIRO</button>
        <button class="btn" onclick="goFullscreen()">Во весь экран</button>
      </div>
    </div>

    <a-scene vr-mode-ui="enabled:false" renderer="colorManagement:true; physicallyCorrectLights:true;" embedded
             arjs="trackingMethod: best; sourceType: webcam; debugUIEnabled:false;" id="scene">
      <a-marker preset="hiro" smooth="true" smoothCount="5" smoothTolerance="0.01" smoothThreshold="2">
        <a-entity id="installation" position="0 0 0" rotation="-90 0 0" scale="1 1 1">
          <a-plane position="0 0 0" rotation="0 0 0" width="1" height="1"
                   material="color:#222; opacity:0.6; transparent:true; metalness:0.1; roughness:0.9"></a-plane>
          <a-entity id="swarm" position="0 0 0"></a-entity>
          <a-entity light="type: ambient; intensity: 1.0"></a-entity>
          <a-entity light="type: directional; intensity: 0.9" position="0 1 1"></a-entity>
        </a-entity>
      </a-marker>
      <a-entity camera="active:true" ></a-entity>
    </a-scene>

    <div class="footer">Если объект не появляется — подойди ближе и держи маркер ровно; размер 10–12 см работает лучше.</div>

    <script>
      function openMarker(){
        window.open('https://raw.githubusercontent.com/AR-js-org/AR.js/master/data/images/HIRO.jpg','_blank');
      }
      function goFullscreen(){
        const el = document.documentElement; (el.requestFullscreen||el.webkitRequestFullscreen||el.msRequestFullscreen||function(){})()
      }

      document.addEventListener('DOMContentLoaded', () => {
        const swarm = document.getElementById('swarm');
        const COUNT = 36;
        for (let i=0;i<COUNT;i++){
          const box = document.createElement('a-box');
          box.setAttribute('depth', 0.02);
          box.setAttribute('height',0.22);
          box.setAttribute('width', 0.22);
          const x = (i-COUNT/2)*0.06;
          const y = Math.sin(i*0.45)*0.20 + 0.25;
          const z = (Math.random()-0.5)*0.55;
          box.setAttribute('position', `${x.toFixed(3)} ${y.toFixed(3)} ${z.toFixed(3)}`);
          const hue = 220 + Math.sin(i*0.3)*40;
          const color = `hsl(${hue}, 70%, 75%)`;
          box.setAttribute('material', `color:${color}; opacity:0.78; transparent:true; metalness:0.2; roughness:0.3`);
          const dur1 = 1200 + Math.random()*1200;
          const dur2 = 3000 + Math.random()*2500;
          box.setAttribute('animation__float', `property=position; to=${x.toFixed(3)} ${(y+0.07).toFixed(3)} ${z.toFixed(3)}; dir=alternate; dur=${Math.floor(dur1)}; loop=true; easing=easeInOutSine`);
          box.setAttribute('animation__rot', `property=rotation; to=${(Math.random()*180).toFixed(1)} ${(Math.random()*360).toFixed(1)} ${(Math.random()*180).toFixed(1)}; dur=${Math.floor(dur2)}; loop=true; easing=linear`);
          swarm.appendChild(box);
        }
        swarm.setAttribute('animation__spin', 'property=rotation; to=0 360 0; dur=14000; easing=linear; loop=true');
      });
    </script>
  </body>
</html>
